<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
		<script src="static/jquery-1.4.4.min.js"></script>
		<script src="static/jquery.jgrowl.js"></script>
		<script src="static/ReittiopasApi.js"></script>
		<script src="static/DummyApi.js"></script>
		<script src="static/Log.js"></script>
		<script src="static/Stop.js"></script>
		<script src="static/Schedules.js"></script>
		<script src="static/Locator.js"></script>
		<link type="text/css" rel="stylesheet" href="static/style/screen.css"/>
		<style>
			#jGrowl { position: absolute; position: fixed; top: 0; text-align: right; right: 0; font-size: 10px; }
				#jGrowl div { background: white; opacity: 0.8 }
		</style>
	</head>
	<body>
		<div id="results"></div>
		<script type="text/javascript">
			// Parse querystring
			var queryString = {}
			window.location.search
				.replace(/^\?/,"")
				.split("&")
				.map(function(p){ 
					var pair =  p.split("=")
					queryString[pair[0]] = pair[1] })

			new Log(queryString["v"])
			var fallbackPosition = { coords: { latitude: "60.1714", longitude: "24.9414" } }
			var api = (queryString["d"]||"").indexOf("a")>-1?
				new DummyApi():new ReittiopasApi("api.asp")

			var schedules = new Schedules(api)
			var locator = new Locator()
			locator.addEventListener("location",function(p){
				schedules.positionUpdated(p.details)
			})
			$(document.body).append(locator.element,schedules.element)
		</script>
	</body>
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-20530172-1']);
		_gaq.push(['_trackPageview']);
		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>
</html>